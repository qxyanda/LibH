using System;

namespace LibH
{
    class HbyTP
    {
        private static readonly double[,] enthalpieWasseres ={
            {4.7841,8.9963,13.206,17.412,21.616,25.818,30.018,34.215,38.411,42.605,46.798,50.989,55.178,59.367,63.554,67.74,71.926,76.11,80.294,84.476,88.659,92.84,97.021,101.2,105.38,109.56,113.74,117.92,122.1,126.28,130.46,134.63,138.81,142.99,147.17,151.35,155.52,159.7,163.88,168.06,172.24,176.41,180.59,184.77,188.95,193.13,197.31,201.49,205.67,209.85,214.03,218.21,222.39,226.57,230.75,234.94,239.12,243.3,247.48,251.67,255.85,260.04,264.22,268.41,272.59,276.78,280.97,285.15,289.34,293.53,297.72,301.91,306.1,310.29,314.48,318.68,322.87,327.06,331.26,335.45,339.65,343.85,348.04,352.24,356.44,360.64,364.84,369.04,373.25,377.45,381.65,385.86,390.07,394.27,398.48,402.69,406.9,411.11,415.33,419.54,423.76,427.97,432.19,436.41,440.63,444.85,449.07,453.3,457.52,461.75,465.98,470.2,474.44,478.67,482.9,487.14,491.37,495.61,499.85,504.09,508.34,512.58,516.83,521.08,525.33,529.58,533.83,538.09,542.35,546.61,550.87,555.13,559.4,563.67,567.93,572.21,576.48,580.76,585.04,589.32,593.6,597.88,602.17,606.46,610.76,615.05,619.35,623.65,627.95,632.26},
            {5.7964,10.004,14.209,18.411,22.611,26.808,31.004,35.197,39.389,43.579,47.768,51.956,56.142,60.327,64.511,68.693,72.875,77.057,81.237,85.417,89.596,93.774,97.952,102.13,106.31,110.48,114.66,118.84,123.01,127.19,131.36,135.54,139.72,143.89,148.07,152.24,156.42,160.59,164.77,168.94,173.12,177.3,181.47,185.65,189.82,194,198.18,202.36,206.53,210.71,214.89,219.07,223.25,227.42,231.6,235.78,239.96,244.14,248.33,252.51,256.69,260.87,265.05,269.24,273.42,277.61,281.79,285.98,290.16,294.35,298.54,302.72,306.91,311.1,315.29,319.48,323.67,327.86,332.06,336.25,340.44,344.64,348.83,353.03,357.23,361.42,365.62,369.82,374.02,378.22,382.43,386.63,390.83,395.04,399.24,403.45,407.66,411.87,416.08,420.29,424.51,428.72,432.93,437.15,441.37,445.59,449.81,454.03,458.25,462.48,466.7,470.93,475.16,479.39,483.62,487.85,492.08,496.32,500.56,504.8,509.04,513.28,517.52,521.77,526.02,530.27,534.52,538.77,543.03,547.28,551.54,555.8,560.07,564.33,568.6,572.87,577.14,581.41,585.69,589.96,594.24,598.53,602.81,607.1,611.39,615.68,619.97,624.27,628.57,632.87}
        };
        private static readonly double[,] enthalpieDampfes = {
            {0,0.01,0.1,0.5,1,3,5,7.00,10,14,20,25,30},
            {0,0,0.1,0.5,1,3,5,7.10,10.1,14.1,20.1,25.1,30},
            {10,42,42.1,42.5,43,44.9,46.9,48.80,51.7,55.6,61.3,66.1,70.8},
            {20,83.9,84,84.3,84.8,86.7,88.6,90.40,93.2,97,102.5,107.1,111.7},
            {40,167.4,167.5,167.9,168.3,170.1,171.9,173.60,176.3,179.8,185.1,189.4,193.8},
            {60,2611.3,251.2,251.2,251.9,253.6,255.3,256.90,259.4,262.8,267.8,272,276.1},
            {80,2649.3,335,335.3,335.7,337.3,338.8,340.40,342.8,346,350.8,354.8,358.7},
            {100,2687.3,2676.5,419.4,419.7,421.2,422.7,424.20,426.5,429.5,434,437.8,441.6},
            {120,2725.4,2716.8,503.9,504.3,505.7,507.1,508.50,510.6,513.5,517.7,521.3,524.9},
            {140,2763.6,2756.6,589.2,589.5,590.8,592.1,593.40,595.4,598,602,605.4,603.1},
            {160,2802,2796.2,2767.3,675.7,676.9,678,679.20,681,683.4,687.1,690.2,693.3},
            {180,2840.6,2835.7,2812.1,2777.3,764.1,765.2,766.20,767.8,769.9,773.1,775.9,778.7},
            {200,2879.3,2875.2,2855.5,2827.5,853,853.8,854.63,855.9,857.7,860.4,862.8,856.2},
            {220,2918.3,2914.7,2898,2874.9,943.9,944.4,945.00,946,947.2,949.3,951.2,953.1},
            {240,2957.4,2954.3,2939.9,2920.5,2823,1037.8,1038.00,1038.4,1039.1,1040.3,1041.5,1024.8},
            {260,2996.8,2994.1,2981.5,2964.8,2885.5,1135,1134.70,1134.3,1134.1,1134,1134.3,1134.8},
            {280,3036.5,3034,3022.9,3008.3,2941.8,2857,1236.70,1235.2,1233.5,1231.6,1230.5,1229.9},
            {300,3076.3,3074.1,3064.2,3051.3,2994.2,2925.4,2839.20,1343.7,1339.5,1334.6,1331.5,1329},
            {350,3177,3175.3,3167.6,3157.7,3115.7,3069.2,3017.00,2924.2,2753.5,1648.4,1626.4,1611.3},
            {400,3279.4,3278,3217.8,3264,3231.6,3196.9,3159.70,3098.5,3004,2820.1,2583.2,2159.1},
            {420,3320.96,3319.68,3313.8,3306.6,3276.9,3245.4,3211.02,3155.98,3072.72,2917.02,2730.76,2424.7},
            {440,3362.52,3361.36,3355.9,3349.3,3321.9,3293.2,3262.34,3213.46,3141.44,3013.94,2878.32,2690.3},
            {450,3383.3,3382.2,3377.1,3370.7,3344.4,3316.8,3288.00,3242.2,3175.8,3062.4,2952.1,2823.1},
            {460,3404.42,3403.34,3398.3,3392.1,3366.8,3340.4,3312.44,3268.58,3205.24,3097.96,2994.68,2875.26},
            {480,3446.66,3445.62,3440.9,3435.1,3411.6,3387.2,3361.32,3321.34,3264.12,3169.08,3079.84,2979.58},
            {500,3488.9,3487.9,3483.7,3478.3,3456.4,3433.8,3410.20,3374.1,3323,3240.2,3165,3083.9},
            {520,3531.82,3530.9,3526.9,3521.86,3501.28,3480.12,3458.60,3425.1,3378.4,3303.7,3237,3166.1},
            {540,3574.74,3573.9,3570.1,3565.42,3546.16,3526.44,3506.40,3475.4,3432.5,3364.6,3304.7,3241.7},
            {550,3593.2,3595.4,3591.7,3587.2,3568.6,3549.6,3530.20,3500.4,3459.2,3394.3,3337.3,3277.7},
            {560,3618,3617.22,3613.64,3609.24,3591.18,3572.76,3554.10,3525.4,3485.8,3423.6,3369.2,3312.6},
            {580,3661.6,3660.86,3657.52,3653.32,3636.34,3619.08,3601.60,3574.9,3538.2,3480.9,3431.2,3379.8},
            {600,3705.2,3704.5,3701.4,3697.4,3681.5,3665.4,3649.00,3624,3589.8,3536.9,3491.2,3444.2}
        };
        /// <summary>
        /// T for ℃
        /// P for MPa
        /// </summary>
        /// <returns></returns>
        public double H(double T, double P, int isSteam)
        {
            if (T < 1) return 0;

            double enthalpy = 0;
            switch (isSteam)
            {
                case 0:
                    {
                        int indexeT = (int)Math.Floor(T) - 1;
                        if (P <= 1)
                        {
                            enthalpy = enthalpieWasseres[0, indexeT] + (enthalpy - enthalpieWasseres[0, indexeT]) * enthalpieWasseres[0, indexeT + 1];
                        }
                        if (P > 1 && P <= 2.5)
                        {
                            enthalpy = enthalpieWasseres[1, indexeT] + (enthalpy - enthalpieWasseres[1, indexeT]) * enthalpieWasseres[1, indexeT + 1];
                        }
                        break;
                    }
                case 1:
                    {
                        int indexP = 0;
                        for (indexP = 1; indexP < 12; indexP++)
                        {
                            if (P > enthalpieDampfes[0, indexP]) break;
                        }
                        int indexT = 0;
                        for (indexT = 1; indexT < 31; indexT++)
                        {
                            if (P > enthalpieDampfes[indexT, 0]) break;
                        }
                        if ((indexP * indexT) == 0) break;

                        double[] weight = { 0, 0 };
                        weight[0] = (P - enthalpieDampfes[0, indexP]) / (enthalpieDampfes[0, indexP + 1] - enthalpieDampfes[0, indexP]);
                        weight[1] = (T - enthalpieDampfes[indexT, 0]) / (enthalpieDampfes[indexT + 1, 0] - enthalpieDampfes[indexT, 0]);

                        enthalpy = enthalpieDampfes[indexT, indexP];
                        enthalpy += weight[0] * (enthalpieDampfes[indexT, indexP + 1] - enthalpieDampfes[indexT, indexP]);
                        enthalpy += weight[1] * (enthalpieDampfes[indexT + 1, indexP] - enthalpieDampfes[indexT, indexP]);
                        break;
                    }
                default:
                    {
                        break;
                    }
            }
            return enthalpy;
        }
    }
}
